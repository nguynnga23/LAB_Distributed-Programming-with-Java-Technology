package Exercise06;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.*;
import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import javax.swing.border.TitledBorder;

import Exercise04.CopyingFileDemo;

import java.awt.Color;
import java.awt.Font;

public class FileSplitter2 extends JFrame {
	private JPanel panel;
	private JTabbedPane tabbedPane;
	private JPanel panel_2;
	private JPanel panel_3;
	private JTextField textField;
	private JTextField textField_1;
	private JTextField textField_2;
	private JProgressBar progressBar;
	private JButton btnNewButton_1;
	private JButton btnNewButton_2;
	
	public static void main(String[] args) {
		SwingUtilities.invokeLater(() -> new FileSplitter2().setVisible(true));
	}

    public FileSplitter2() {
    	
    	
    	 
        setTitle("File Splitter");
        setSize(520, 320);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        getContentPane().setLayout(new BorderLayout(0, 0));
        
        panel = new JPanel();
        getContentPane().add(panel, BorderLayout.NORTH);
        panel.setLayout(new BorderLayout(0, 0));
        
        tabbedPane = new JTabbedPane(JTabbedPane.TOP);
        tabbedPane.setBackground(new Color(255, 255, 255));
        getContentPane().add(tabbedPane, BorderLayout.CENTER);
        
        panel_2 = new JPanel();
        panel_2.setBackground(new Color(255, 255, 255));
        panel_2.setBorder(new TitledBorder(null, "Split File", TitledBorder.LEADING, TitledBorder.TOP, null, null));
        tabbedPane.addTab("SPLIT", new ImageIcon(FileSplitter2.class.getResource("/Exercise06/split.png")), panel_2, null);
        panel_2.setLayout(null);
        
        textField = new JTextField();
        textField.setBounds(82, 39, 358, 30);
        panel_2.add(textField);
        textField.setColumns(10);
        
        JLabel lblNewLabel = new JLabel("Input File :");
        lblNewLabel.setFont(new Font("Tahoma", Font.BOLD, 11));
        lblNewLabel.setBounds(10, 39, 62, 30);
        panel_2.add(lblNewLabel);
        
        JLabel lblOutputFile = new JLabel("Output File :");
        lblOutputFile.setFont(new Font("Tahoma", Font.BOLD, 11));
        lblOutputFile.setBounds(10, 86, 68, 30);
        panel_2.add(lblOutputFile);
        
        textField_1 = new JTextField();
        textField_1.setColumns(10);
        textField_1.setBounds(82, 86, 358, 30);
        panel_2.add(textField_1);
        
        JLabel lblEnterNumberOf = new JLabel("Enter number of files to split into :");
        lblEnterNumberOf.setFont(new Font("Tahoma", Font.BOLD, 11));
        lblEnterNumberOf.setBounds(10, 132, 205, 30);
        panel_2.add(lblEnterNumberOf);
        
        textField_2 = new JTextField();
        textField_2.setColumns(10);
        textField_2.setBounds(225, 132, 215, 30);
        panel_2.add(textField_2);
        
        JButton btnNewButton = new JButton("Split Its");
        btnNewButton.setBounds(203, 187, 92, 30);
        panel_2.add(btnNewButton);
        
        progressBar = new JProgressBar();
        progressBar.setBounds(10, 225, 481, 21);
        panel_2.add(progressBar);
        
        btnNewButton_1 = new JButton("...");
        btnNewButton_1.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		splitFile();
        	}
        });
        btnNewButton_1.setBounds(445, 39, 46, 30);
        panel_2.add(btnNewButton_1);
        
        btnNewButton_2 = new JButton("...");
        btnNewButton_2.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		splitFile();
        	}
        });
        btnNewButton_2.setBounds(445, 86, 46, 30);
        panel_2.add(btnNewButton_2);
        
        panel_3 = new JPanel();
        panel_3.setBorder(new TitledBorder(null, "Combine File", TitledBorder.LEADING, TitledBorder.TOP, null, null));
        tabbedPane.addTab("COMBINE", null, panel_3, null);
    }

    private void splitFile() {
        JFileChooser fileChooser = new JFileChooser();
        fileChooser.setDialogTitle("Select File to Split");
        int result = fileChooser.showOpenDialog(this);

        if (result == JFileChooser.APPROVE_OPTION) {
            File selectedFile = fileChooser.getSelectedFile();
            split(selectedFile);
        }
    }
    
    

   
    
    private void split(File file) {
        try (BufferedInputStream in = new BufferedInputStream(new FileInputStream(file))) {
            int partNumber = 2;
            int bytesRead;
            byte[] buffer = new byte[1024 * 1024]; // 1 MB buffer size
            long fileSize = file.length();
            long totalBytesRead = 0;

            while ((bytesRead = in.read(buffer)) != -1) {
                String partFileName = file.getName() + ".part" + partNumber;
                try (BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream(partFileName))) {
                    out.write(buffer, 0, bytesRead);
                }

                totalBytesRead += bytesRead;
                int progress = (int) ((totalBytesRead * 100) / fileSize);
                progressBar.setValue(progress);

                partNumber++;
            }

            JOptionPane.showMessageDialog(this, "File split successfully!");
        } catch (IOException e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "Error occurred while splitting the file.");
        }
    }
}
